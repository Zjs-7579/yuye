<template>
  <div class="AgHold">
    <p
      class="isHoldInfo"
      :style="{ display: isDisabledData ? 'none' : 'block' }"
    >
      æ˜¯å¦æœ‰å›½å®¶ã€çœã€å¸‚è´¢æ”¿è¿‘ä¸‰å¹´å…¨éƒ¨æ”¯æŒæƒ…å†µæ–‡ä»¶&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- <el-switch
				v-model="isHold"
				active-color="#13ce66"
				inactive-color="#ff4949"
				active-text="æ˜¯"
  				inactive-text="å¦"
			>
			</el-switch> -->
      <el-radio-group v-model="isHold">
        <el-radio :label="true">æ˜¯</el-radio>
        <el-radio :label="false">å¦</el-radio>
      </el-radio-group>
    </p>
    <div v-if="isHold">
      <el-form
        :style="{ display: isHold ? 'block' : 'none' }"
        v-for="(item, index) in agriculturalSupport"
        :rules="rules"
        :key="index"
        ref="holdForm"
        :model="agriculturalSupport[index]"
        :disabled="isDisabledData"
        label-width="210px"
        class="demo-ruleForm"
      >
        <!-- <el-row class="title"> å›½å®¶ã€çœã€å¸‚è´¢æ”¿è¿‘ä¸‰å¹´å…¨éƒ¨æ”¯æŒæƒ…å†µ </el-row> -->
        <el-row class="title"> é¡¹ç›®åŸºæœ¬æƒ…å†µ </el-row>
        <el-form-item
          :label="'é¡¹ç›®åç§°' + (index + 1) + 'ï¼š'"
          prop="project_name"
        >
          <el-input v-model="item.project_name"></el-input>
        </el-form-item>
        <el-row>
          <el-col :span="8">
            <el-form-item label="èµ„åŠ©å•ä½ï¼š" prop="funding_unit">
              <el-input v-model="item.funding_unit"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="å—èµ„åŠ©å¹´ä»½ï¼š" prop="funding_year">
              <el-date-picker
                type="year"
                value-format="yyyy"
                placeholder="é€‰æ‹©èµ„åŠ©å¹´ä»½"
                v-model="item.funding_year"
                style="width: 100%"
              ></el-date-picker>
            </el-form-item>

            <!-- <el-form-item label="å—èµ„åŠ©å¹´ä»½ï¼š" prop="funding_year">
              <el-input v-model="item.funding_year"></el-input>
            </el-form-item> -->
          </el-col>
          <el-col :span="8">
            <el-form-item label="ä¸‹è¾¾æ–‡å·ï¼š" prop="release_no">
              <el-input v-model="item.release_no"></el-input>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row>
          <el-col :span="8">
            <el-form-item label="èµ„åŠ©é‡‘é¢ï¼ˆä¸‡å…ƒï¼‰ï¼š" prop="subsidy_amount">
              <el-input v-model="item.subsidy_amount"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="é¡¹ç›®è´Ÿè´£äººï¼š" prop="project_leader">
              <el-input v-model="item.project_leader"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="è”ç³»ç”µè¯ï¼š" prop="phone">
              <el-input v-model="item.phone"></el-input>
            </el-form-item>
          </el-col>
        </el-row>

        <el-form-item label="é¡¹ç›®å»ºè®¾å†…å®¹ã€è§„æ¨¡ï¼š" prop="project_content">
          <el-input
            type="textarea"
            resize="none"
            rows="8"
            v-model="item.project_content"
          ></el-input>
        </el-form-item>

        <el-row>
          <el-col :span="8">
            <el-form-item label="é¡¹ç›®å®æ–½å¹´é™ï¼š" prop="project_years">
              <el-input type="text" v-model="item.project_years"></el-input>
              <!-- <el-date-picker 
              value-format="yyyy-MM"
              type="month"
              placeholder="é€‰æ‹©å¹´é™" 
              v-model="item.project_years" 
              style="width: 100%;"></el-date-picker> -->
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item
              label="æ˜¯å¦å®ŒæˆéªŒæ”¶åŠæ—¶é—´ï¼š"
              :prop="isAccept[index] ? 'accept' : ''"
              class="isAccept"
            >
              <el-radio-group v-model="isAccept[index]">
                <el-radio :label="true">æ˜¯</el-radio>
                <el-radio :label="false">å¦</el-radio>
              </el-radio-group>

              <el-date-picker
                v-if="isAccept[index]"
                value-format="yyyy-MM-DD"
                type="date"
                placeholder="é€‰æ‹©éªŒæ”¶æ—¶é—´"
                v-model="item.accept"
                style="width: 60%"
              ></el-date-picker>
              <!-- <el-date-picker
              value-format="yyyy-MM"
              type="month"
              placeholder="é€‰æ‹©éªŒæ”¶æ—¶é—´"
              v-model="item.accept"
              style="width: 100%;"></el-date-picker> -->
              <!-- <el-input
                type="textarea"
                resize="none"
                rows="6"
                v-model="item.accept"
              ></el-input> -->
              <!-- <el-popconfirm
                confirm-button-text='å¥½çš„'
                cancel-button-text='ä¸ç”¨äº†'
                icon="el-icon-info"
                icon-color="red"
                title="è¿™æ˜¯ä¸€æ®µå†…å®¹ç¡®å®šåˆ é™¤å—ï¼Ÿ"
              >
              <el-date-picker slot="reference" type="date" placeholder="é€‰æ‹©æ—¥æœŸ" v-model="item.accept" style="width: 100%;"></el-date-picker>
              </el-popconfirm> -->
            </el-form-item>

            <!-- <el-col :span="4" v-if="isAccept">
            <el-form-item prop="accept" style="background-color: red">
              <el-input type="text" v-model="item.accept"></el-input>
            </el-form-item>
          </el-col> -->
          </el-col>
          <el-col :span="8">
            <el-form-item label="æœªå®ŒæˆéªŒæ”¶åŸå› (å·²å®Œæˆä¸å¡«)ï¼š" prop="reasons">
              <el-input type="text" v-model="item.reasons"></el-input>
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>
    </div>
    <div
      class="handle"
      :style="{ display: isDisabledData || !isHold ? 'none' : 'block' }"
    >
      <el-button class="add" @click="handleDeleteHtml">åˆ é™¤ä¸€æ¡</el-button>
      <el-button type="primary" class="add" @click="handleAddHtml"
        >æ·»åŠ ä¸€æ¡</el-button
      >
    </div>
  </div>
</template>

<script>
import { HoldInfoValidator } from "../../../utils/validator";
import { mapState } from "vuex";
export default {
  data() {
    return {
      isHold: true,
      isAccept: [],
      rules: HoldInfoValidator,
    };
  },
  mounted() {
    console.log(this.isAccept, "ğŸ‘»");
  },
  computed: {
    ...mapState(["Agricul"]),
    agriculturalSupport: {
      get() {
        this.Agricul.AgriculData.agriculturalSupport[0]["task_id"] =
          this.Agricul.userTaskId;
        this.isAccept = this.Agricul.AgriculData.agriculturalSupport.map(
          (item) => !item.accept
        );
        // this.Agricul.AgriculData.agriculturalSupport[0].creator =
        //   this.Total.userName;
        return this.Agricul.AgriculData.agriculturalSupport;
      },
      set(val) {
        this.agriculturalSupport = val;
      },
    },
    isAccept: {
      get() {
        let list = [];
        //console.log(this.Agricul.AgriculData.agriculturalSupport[0].accept)
        // this.Agricul.AgriculData.agriculturalSupport[0].creator =
        //   this.Total.userName;
        for (let item of this.Agricul.AgriculData.agriculturalSupport) {
          if (item.accept == "") {
            list.push(false);
          } else {
            list.push(true);
          }
        }
        console.log(list);
        // if(this.Agricul.AgriculData.agriculturalSupport.accept){
        //   return true
        // }else{
        //   return false
        // }
        //return this.Agricul.AgriculData.agriculturalSupport.accept;
        return list;
      },
      set(val) {
        this.isAccept = val;
      },
    },
    isDisabledData: {
      get() {
        return this.Agricul.isDisabledData;
      },
      set(val) {
        this.isDisabledData = val;
      },
    },
  },
  methods: {
    handleAddHtml() {
      let str = {
        task_id: this.Agricul.userTaskId,
        project_name: "",
        funding_unit: "",
        funding_year: "",
        release_no: "",
        subsidy_amount: "",
        project_leader: "",
        phone: "",
        project_content: "",
        project_years: "",
        accept: "",
        reasons: "",
        //creator: this.Total.userName,
        // create_time: "",
        // modifier: '',
        // update_time: ''
      };
      this.agriculturalSupport.push(str);
    },
    handleDeleteHtml() {
      let len = this.agriculturalSupport.length;
      if (len == 1) {
        this.$message({
          message: "å°±å‰©æœ€åä¸€æ¡ä¿¡æ¯äº†ï¼ï¼ï¼",
          type: "warning",
        });
      } else {
        this.agriculturalSupport.splice(len - 1, 1);
      }
    },
  },
  watch: {
    isHold(per) {
      console.log(per);
      //console.log(this.agriculturalSupport)
      if (per) {
        //console.log(per)
        //console.log(this.modernSupport)
        this.handleAddHtml();
        let len = this.agriculturalSupport.length;
        this.agriculturalSupport.splice(0, len - 1);

        //console.log(this.modernSupport)
      }
      //this.$refs.holdForm.resetFields();
    },
  },
};
</script>

<style>
.AgHold .isHoldInfo {
  height: 40px;
  padding: 0 20px;
  line-height: 40px;
  background-color: #f3f5f9;
}
.AgHold {
  width: 100%;
  height: 75vh;
  overflow: hidden;
  overflow-y: auto;
}
.AgHold .demo-ruleForm {
  margin-bottom: 60px;
}
.AgHold .title {
  background-color: #ece8e8;
  height: 60px;
  line-height: 60px;
  font-size: 25px;
  padding: 0 15px;
  font-weight: bold;
}
.AgHold .title .el-input__inner {
  border: none;
  background-color: #ece8e8;
}

.AgHold .demo-ruleForm {
  border: 1px solid #ccc;
  margin: 0;
  padding: 0;
}

.AgHold .el-form-item {
  margin: 0;
  border: 1px solid #ccc;
  /* height: 60px; */
}
.AgHold .el-form-item__label {
  text-align: center;
  height: 60px;
  line-height: 60px;
  /* line-height: 60px; */
  /* border: 1px solid #ccc; */
}
/* .el-input{
  height: 60px;
  line-height: ;
} */
.AgHold .el-form-item__content {
  border-left: 1px solid #ccc;
  line-height: 60px;
}

.AgHold .el-input__inner {
  border: none;
}
.AgHold .el-textarea__inner {
  border: none;
}
.AgHold .isAccept .el-form-item__content {
  display: flex;
}
.AgHold .isAccept .el-radio-group {
  padding: 0;
  margin: 0;
  display: block;
  flex: 1;
}
.AgHold .isAccept .el-radio {
  line-height: 60px;
  margin: 0 15px;
}
.AgHold .isAccept .el-input__inner {
  line-height: 40px;
  flex: 2;
}
.handle {
  width: 515px;
  margin: 20px auto;
}
.handle button {
  margin: 0 100px;
}
</style>
